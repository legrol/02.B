# ══ Compilation══════════════════════════════════════════════════════════════ #
#    -----------                                                               #
# ════════════════════════════════════════════════════════════════════════════ #
CC := gcc
AR := ar rcs

# ══ Flags ═══════════════════════════════════════════════════════════════════ #
#    -----                                                                     #
# ════════════════════════════════════════════════════════════════════════════ #
CFLAGS := -Wall -Wextra -O2 -m32 -fno-stack-protector -fno-builtin

# ══ Sources ═════════════════════════════════════════════════════════════════ #
#    -------                                                                   #
# ════════════════════════════════════════════════════════════════════════════ #
SRCS := $(wildcard *.c *.s)
# exclude C implementation if assembly version exists
SRCS := $(filter-out b_ipow.c,$(SRCS))

# ══ Objects ═════════════════════════════════════════════════════════════════ #
#    -------                                                                   #
# ════════════════════════════════════════════════════════════════════════════ #
OBJS := $(SRCS:.c=.o)
OBJS := $(OBJS:.s=.o)

# ══ Library ═════════════════════════════════════════════════════════════════ #
#    -------                                                                   #
# ════════════════════════════════════════════════════════════════════════════ #
LIB := libb.a

# ═══ Rules ══════════════════════════════════════════════════════════════════ #
#     -----                                                                    #
# ════════════════════════════════════════════════════════════════════════════ #
all: $(LIB)

%.o: %.c
	$(CC) $(CFLAGS) -c $< -o $@

%.o: %.s
	$(CC) $(CFLAGS) -c $< -o $@

$(LIB): $(OBJS)
	$(AR) $(LIB) $(OBJS)

clean:
	rm -f $(OBJS) $(LIB)

.PHONY: all clean
